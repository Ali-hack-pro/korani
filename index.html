<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام تسجيل الحضور</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #e74c3c;
            --text-color: #333;
            --light-bg: #f9f9f9;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --btn-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        /* تخصيص شريط التمرير */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
            transition: background 0.3s;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #2980b9;
        }
        
        body {
            background: linear-gradient(-45deg, #f5f7fa, #c3cfe2, #a1c4fd, #f5f7fa);
            background-size: 400% 400%;
            animation: gradient 5s ease infinite;
            color: var(--text-color);
            line-height: 1.6;
            transition: all 0.5s ease;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            transition: all 0.5s ease;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
        }
        
        .logo {
            height: 60px;
            margin-left: 15px;
            transition: all 0.5s ease;
        }
        
        .class-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
            background: #e8f4fc;
            padding: 8px 15px;
            border-radius: 20px;
            text-align: center;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .language-switcher {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: var(--btn-shadow);
        }
        
        .language-switcher:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .main-content {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: var(--shadow);
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .fade-out {
            opacity: 0;
            transform: translateY(20px);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        input[type="text"]:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .buttons-container {
            display: flex;
            flex-direction: column;
            margin-top: 30px;
            gap: 15px;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            text-align: center;
            box-shadow: var(--btn-shadow);
            width: 100%;
        }
        
        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .btn-secondary {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }
        
        .btn-secondary:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        .attendance-list {
            margin-top: 30px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        
        .attendance-list h2 {
            margin-bottom: 15px;
            color: var(--primary-color);
            position: sticky;
            top: 0;
            background: white;
            padding: 10px 0;
            z-index: 1;
        }
        
        #attendanceRecords {
            list-style-type: none;
        }
        
        #attendanceRecords li {
            background-color: #f1f1f1;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s, background-color 0.2s;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        #attendanceRecords li:hover {
            transform: translateX(5px);
            background-color: #e8f4fc;
        }
        
        .timestamp {
            color: #777;
            font-size: 14px;
        }
        
        .student-name {
            font-weight: bold;
        }
        
        .empty-state {
            text-align: center;
            padding: 20px;
            color: #777;
            font-style: italic;
        }
        
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 45px 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            box-shadow: var(--btn-shadow);
            z-index: 1000;
            animation: slideIn 0.5s ease, fadeOut 0.5s ease 2.5s forwards;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; visibility: hidden; }
        }
        
        .success {
            background-color: var(--secondary-color);
        }
        
        .error {
            background-color: var(--accent-color);
        }
        
        .loading {
            background-color: var(--primary-color);
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            width: 90%;
            max-width: 500px;
            animation: slideUp 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-title {
            font-size: 20px;
            color: var(--primary-color);
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #777;
        }
        
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
            }
            
            .logo-container {
                margin-bottom: 15px;
            }
            
            .header-controls {
                width: 100%;
                justify-content: center;
                margin-top: 10px;
            }
            
            .buttons-container {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .message {
                right: 10px;
                left: 10px;
                text-align: center;
            }
        }
        
        /* اللغة الألمانية */
        body[dir="ltr"] {
            text-align: left;
        }
        
        body[dir="ltr"] .logo {
            margin-left: 0;
            margin-right: 15px;
        }
        
        body[dir="ltr"] header {
            flex-direction: row-reverse;
        }
        
        body[dir="ltr"] #attendanceRecords li:hover {
            transform: translateX(-5px);
        }
        
        body[dir="ltr"] .message {
            right: auto;
            left: 20px;
        }
        
        @keyframes slideInLTR {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        body[dir="ltr"] .message {
            animation: slideInLTR 0.5s ease, fadeOut 0.5s ease 2.5s forwards;
        }
    </style>
</head>
<body>
    <div class="container">
        <header id="pageHeader">
            <div class="logo-container">
                <img src="https://korani.eu/img/logoar.png" alt="شعار الموقع" class="logo">
                <div class="class-name" id="className">الفصل: غير محدد</div>
            </div>
            <div class="header-controls">
                <button class="language-switcher" id="languageSwitcher">Deutsch</button>
            </div>
        </header>
        
        <div class="main-content" id="mainContent">
            <form id="attendanceForm">
                <div class="form-group">
                    <label for="firstName" id="firstNameLabel">الاسم الأول</label>
                    <input type="text" id="firstName" required>
                </div>
                
                <div class="form-group">
                    <label for="lastName" id="lastNameLabel">الاسم الثاني</label>
                    <input type="text" id="lastName" required>
                </div>
                
                <div class="buttons-container">
                    <button type="submit" class="btn" id="submitBtn">تسجيل الحضور</button>
                    <button type="button" class="btn btn-secondary" id="addStudentBtn">طالب آخر +</button>
                </div>
            </form>
            
            <div class="attendance-list">
                <h2 id="attendanceListTitle">سجل الحضور</h2>
                <ul id="attendanceRecords">
                    <li class="empty-state" id="emptyState">لم يتم تسجيل أي حضور بعد</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- نافذة إضافة طالب جديد -->
    <div class="modal" id="studentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">تسجيل حضور طالب آخر</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <form id="modalForm">
                <div class="form-group">
                    <label for="modalFirstName" id="modalFirstNameLabel">Vorname</label>
                    <input type="text" id="modalFirstName" required>
                </div>
                
                <div class="form-group">
                    <label for="modalLastName" id="modalLastNameLabel">Nachname</label>
                    <input type="text" id="modalLastName" required>
                </div>
                
                <div class="buttons-container">
                    <button type="submit" class="btn btn-secondary" id="modalSubmitBtn">تسجيل الحضور</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // رابط Google Apps Script المقدم من المستخدم
        const API_URL = 'https://script.google.com/macros/s/AKfycby58GdjjpPFXdmeqDwhomlvphVNY2_ycBQ59kWbZbxwcTsCTtJq-0D5tEp1mNHJnPQIXw/exec';
        
        // تعريف الفصول حسب الأرقام المطلوبة
        const classes = {
            1: "معلمة جنين - الاثنين",
            2: "معلمة احلام - الاثنين",
            3: "معلمة ايات العدوي - الاثنين",
            4: "معلمة سمر - الاثنين",
            5: "معلمة الاء زيادة - الاثنين",
            6: "معلمة رانبا - الاثنين",
            7: "معلم عبادة الاشقر - الاثنين",
            8: "معلمة اسماء السلطان - الاثنين",
            9: "معلمة سناء - الاثنين",
            10: "معلمة فوزية - الخميس",
            11: "معلمة ام عمر - الخميس",
            12: "معلمة براء - الخميس",
            13: "معلمة ناريمان صالح - الخميس",
            14: "معلم عثمان الخطيب - الخميس",
            15: "معلمة .ام براء - الخميس",
            16: "معلمة مروة - الخميس",
            17: "معلمة روان - الخميس",
            18: "معلمة سمر - الخميس",
            19: "معلمة سناء - الخميس",
            20: "معلمة شيماء - الجمعة",
            21: "معلمة دانا - الجمعة",
            22: "محمود دغميس - الجمعة",
            23: "معلمة أمامة أبو حطب - الجمعة",
            24: "معلمة بسمة - الجمعة",
            25: "معلمة ماريا - الجمعة",
            26: "احمد الشرقاوي - الجمعة",
            27: "معلم احمد الشرقاوي - الاحد",
            28: "معلمة يسرا السلطان - الاحد",
            29: "الشيخ عمار - الاحد",
            30: "المعلمة ريعان عسقول - الخميس",
            31: "الشيخ اسامة السلطان - الاحد",
            32: "الشيخ أمين - الاحد",
            33: "المعلمة سناء - الاربعاء",
            34: "المعلمة سناء - الاحد",
            35: "صف النورانية الاول - الخميس",
            36: "صف النورانية الثاني - الخميس"
        };
        
        // متغير لتخزين معرف الفاصل الزمني للتحديث التلقائي
        let refreshInterval;
        
        document.addEventListener('DOMContentLoaded', function() {
            // العناصر الرئيسية
            const form = document.getElementById('attendanceForm');
            const firstNameInput = document.getElementById('firstName');
            const lastNameInput = document.getElementById('lastName');
            const attendanceRecords = document.getElementById('attendanceRecords');
            const languageSwitcher = document.getElementById('languageSwitcher');
            const emptyState = document.getElementById('emptyState');
            const mainContent = document.getElementById('mainContent');
            const pageHeader = document.getElementById('pageHeader');
            const addStudentBtn = document.getElementById('addStudentBtn');
            const studentModal = document.getElementById('studentModal');
            const modalClose = document.getElementById('modalClose');
            const modalForm = document.getElementById('modalForm');
            const modalFirstName = document.getElementById('modalFirstName');
            const modalLastName = document.getElementById('modalLastName');
            const classNameElement = document.getElementById('className');
            
            // الحصول على رقم الفصل من الرابط
            const urlParams = new URLSearchParams(window.location.search);
            const classNumber = parseInt(urlParams.get('class'));
            
            // تحديد الفصل بناءً على الرقم
            let currentClass = 'غير محدد';
            let classId = classNumber;
            
            if (classNumber && classes[classNumber]) {
                currentClass = classes[classNumber];
            } else if (classNumber) {
                // إذا كان الرقم غير موجود في القائمة، نستخدم الرقم كمعرف للفصل
                currentClass = `فصل ${classNumber}`;
            }
            
            classNameElement.textContent = `الفصل: ${currentClass}`;
            
            // النصوص باللغتين
            const texts = {
                ar: {
                    firstNameLabel: "الاسم الأول",
                    lastNameLabel: "الاسم الثاني",
                    submitBtn: "تسجيل الحضور",
                    addStudentBtn: "طالب آخر +",
                    attendanceListTitle: "سجل الحضور",
                    languageBtn: "Deutsch",
                    emptyState: "لم يتم تسجيل أي حضور بعد",
                    successMessage: "تم تسجيل حضور {name} بنجاح",
                    errorMessage: "يرجى ملء جميع الحقول",
                    modalTitle: "تسجيل حضور طالب آخر",
                    modalFirstNameLabel: "Vorname",
                    modalLastNameLabel: "Nachname",
                    className: `الفصل: ${currentClass}`
                },
                de: {
                    firstNameLabel: "Vorname",
                    lastNameLabel: "Nachname",
                    submitBtn: "Anwesenheit registrieren",
                    addStudentBtn: "Anderer Schüler +",
                    attendanceListTitle: "Anwesenheitsliste",
                    languageBtn: "العربية",
                    emptyState: "Noch keine Anwesenheit registriert",
                    successMessage: "Anwesenheit von {name} erfolgreich registriert",
                    errorMessage: "Bitte füllen Sie alle Felder aus",
                    modalTitle: "Anwesenheit eines anderen Schülers registrieren",
                    modalFirstNameLabel: "Vorname",
                    modalLastNameLabel: "Nachname",
                    className: `Klasse: ${currentClass}`
                }
            };
            
            // التحقق من وجود الكوكي وتعيين القيمة للطالب الأساسي
            const savedStudentName = getCookie('studentName');
            if (savedStudentName) {
                const names = savedStudentName.split(' ');
                firstNameInput.value = names[0] || '';
                lastNameInput.value = names[1] || '';
            }
            
            // جلب بيانات الحضور عند تحميل الصفحة
            fetchAttendance();
            
            // بدء التحديث التلقائي كل 10 ثوانٍ
            startAutoRefresh();
            
            // تغيير اللغة مع animation
            let currentLang = 'ar';
            let isAnimating = false;
            
            languageSwitcher.addEventListener('click', function() {
                if (isAnimating) return;
                
                isAnimating = true;
                // إضافة تأثير fade-out للهيدر والمحتوى
                pageHeader.classList.add('fade-out');
                mainContent.classList.add('fade-out');
                
                // بعد انتهاء الـ animation، تغيير اللغة وإعادة الظهور
                setTimeout(() => {
                    currentLang = currentLang === 'ar' ? 'de' : 'ar';
                    updateLanguage(currentLang);
                    
                    // إزالة fade-out لإظهار المحتوى مرة أخرى
                    pageHeader.classList.remove('fade-out');
                    mainContent.classList.remove('fade-out');
                    isAnimating = false;
                }, 500);
            });
            
            // تحديث اللغة
            function updateLanguage(lang) {
                document.documentElement.lang = lang;
                document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
                
                document.getElementById('firstNameLabel').textContent = texts[lang].firstNameLabel;
                document.getElementById('lastNameLabel').textContent = texts[lang].lastNameLabel;
                document.getElementById('submitBtn').textContent = texts[lang].submitBtn;
                document.getElementById('addStudentBtn').textContent = texts[lang].addStudentBtn;
                document.getElementById('attendanceListTitle').textContent = texts[lang].attendanceListTitle;
                document.getElementById('modalTitle').textContent = texts[lang].modalTitle;
                document.getElementById('modalFirstNameLabel').textContent = texts[lang].modalFirstNameLabel;
                document.getElementById('modalLastNameLabel').textContent = texts[lang].modalLastNameLabel;
                document.getElementById('modalSubmitBtn').textContent = texts[lang].submitBtn;
                document.getElementById('className').textContent = texts[lang].className;
                languageSwitcher.textContent = texts[lang].languageBtn;
                emptyState.textContent = texts[lang].emptyState;
            }
            
            // بدء التحديث التلقائي
            function startAutoRefresh() {
                // تحديث البيانات كل 10 ثوانٍ
                refreshInterval = setInterval(fetchAttendance, 10000);
            }
            
            // إيقاف التحديث التلقائي
            function stopAutoRefresh() {
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                }
            }
            
            // فتح نافذة إضافة طالب جديد
            addStudentBtn.addEventListener('click', function() {
                studentModal.style.display = 'flex';
            });
            
            // إغلاق نافذة إضافة طالب جديد
            modalClose.addEventListener('click', function() {
                studentModal.style.display = 'none';
                modalForm.reset();
            });
            
            // إغلاق النافذة عند النقر خارجها
            window.addEventListener('click', function(event) {
                if (event.target === studentModal) {
                    studentModal.style.display = 'none';
                    modalForm.reset();
                }
            });
            
            // تسجيل الحضور للطالب الأساسي
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                registerAttendance(firstNameInput.value.trim(), lastNameInput.value.trim(), true);
            });
            
            // تسجيل الحضور للطالب الآخر
            modalForm.addEventListener('submit', function(e) {
                e.preventDefault();
                registerAttendance(modalFirstName.value.trim(), modalLastName.value.trim(), false);
                studentModal.style.display = 'none';
                modalForm.reset();
            });
            
            // وظيفة تسجيل الحضور
            function registerAttendance(firstName, lastName, isMainStudent) {
                if (firstName && lastName) {
                    // حفظ بيانات الطالب الأساسي في الكوكي
                    if (isMainStudent) {
                        setCookie('studentName', `${firstName} ${lastName}`, 30);
                    }
                    
                    // إرسال البيانات إلى API
                    const now = new Date();
                    const timeString = now.toLocaleString();
                    
                    showMessage(currentLang === 'ar' ? 'جاري تسجيل الحضور...' : 'Anwesenheit wird registriert...', 'loading');
                    
                    // استخدام رقم الفصل كمعرف عند الإرسال
                    const classIdentifier = classId || currentClass;
                    
                    // إنشاء رابط API مع المعلمات
                    const url = `${API_URL}?action=add&first=${encodeURIComponent(firstName)}&second=${encodeURIComponent(lastName)}&class=${encodeURIComponent(classIdentifier)}&time=${encodeURIComponent(timeString)}`;
                    
                    fetch(url)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.text();
                    })
                    .then(result => {
                        console.log('API Response:', result);
                        
                        // إخفاء رسالة عدم وجود بيانات
                        if (emptyState.style.display !== 'none') {
                            emptyState.style.display = 'none';
                        }
                        
                        // مسح الحقول للطالب الأساسي فقط
                        if (isMainStudent) {
                            lastNameInput.value = '';
                        }
                        
                        // عرض رسالة نجاح
                        showMessage(texts[currentLang].successMessage.replace('{name}', `${firstName} ${lastName}`), 'success');
                        
                        // جلب البيانات المحدثة من السيرفر
                        fetchAttendance();
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showMessage(currentLang === 'ar' ? 'حدث خطأ في التسجيل' : 'Fehler bei der Registrierung', 'error');
                    });
                } else {
                    showMessage(texts[currentLang].errorMessage, 'error');
                }
            }
            
            // وظيفة لجلب بيانات الحضور من API
            function fetchAttendance() {
                const url = `${API_URL}?action=get`;
                
                fetch(url)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Fetched data:', data);
                        
                        // استخدام رقم الفصل كمعرف للتصفية
                        const classIdentifier = classId || currentClass;
                        
                        // تصفية البيانات للفصل الحالي فقط
                        const classData = data.filter(item => {
                            return item.class == classIdentifier; // استخدام == للسماح بمقارنة الأرقام والنصوص
                        });
                        
                        if (classData.length > 0) {
                            // إخفاء رسالة عدم وجود بيانات
                            if (emptyState.style.display !== 'none') {
                                emptyState.style.display = 'none';
                            }
                            
                            // مسح القائمة الحالية
                            attendanceRecords.innerHTML = '';
                            
                            // إضافة البيانات إلى القائمة
                            classData.forEach(student => {
                                const listItem = document.createElement('li');
                                listItem.innerHTML = `
                                    <span class="student-name">${student.first} ${student.second}</span>
                                    <span class="timestamp">${student.time}</span>
                                `;
                                attendanceRecords.appendChild(listItem);
                            });
                        } else {
                            // عرض رسالة عدم وجود بيانات
                            emptyState.style.display = 'block';
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching attendance data:', error);
                        // في حالة الخطأ، نعرض رسالة خطأ مؤقتة
                        if (attendanceRecords.children.length === 0 || (attendanceRecords.children.length === 1 && attendanceRecords.children[0].classList.contains('empty-state'))) {
                            emptyState.textContent = currentLang === 'ar' ? 'خطأ في تحميل البيانات' : 'Fehler beim Laden der Daten';
                            emptyState.style.display = 'block';
                        }
                    });
            }
            
            // وظيفة لعرض الرسائل
            function showMessage(message, type) {
                // إزالة أي رسالة سابقة
                const existingMessage = document.querySelector('.message');
                if (existingMessage) {
                    existingMessage.remove();
                }
                
                // إنشاء رسالة جديدة
                const messageElement = document.createElement('div');
                messageElement.className = `message ${type}`;
                messageElement.textContent = message;
                
                // إضافة زر الإغلاق
                const closeBtn = document.createElement('button');
                closeBtn.className = 'close-btn';
                closeBtn.innerHTML = '&times;';
                closeBtn.addEventListener('click', function() {
                    messageElement.remove();
                });
                
                messageElement.appendChild(closeBtn);
                document.body.appendChild(messageElement);
                
                // إزالة الرسالة تلقائياً بعد 3 ثوانٍ
                setTimeout(() => {
                    if (messageElement.parentNode) {
                        messageElement.remove();
                    }
                }, 3000);
            }
            
            // وظائف إدارة الكوكيز
            function setCookie(name, value, days) {
                const d = new Date();
                d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
                const expires = "expires=" + d.toUTCString();
                document.cookie = name + "=" + value + ";" + expires + ";path=/";
            }
            
            function getCookie(name) {
                const cookieName = name + "=";
                const decodedCookie = decodeURIComponent(document.cookie);
                const cookieArray = decodedCookie.split(';');
                
                for(let i = 0; i < cookieArray.length; i++) {
                    let cookie = cookieArray[i];
                    while (cookie.charAt(0) === ' ') {
                        cookie = cookie.substring(1);
                    }
                    if (cookie.indexOf(cookieName) === 0) {
                        return cookie.substring(cookieName.length, cookie.length);
                    }
                }
                return "";
            }
            
            // إيقاف التحديث التلقائي عند إغلاق الصفحة
            window.addEventListener('beforeunload', function() {
                stopAutoRefresh();
            });
        });
    </script>
</body>
</html>
